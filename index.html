<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A simple E2E test runner application that uses Playwright to test web pages">
  <meta name="theme-color" content="#3b82f6">
  <title>Playwright E2E Test Runner</title>
  
  <!-- Import React (use production version for better performance) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Import Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Import Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üé≠</text></svg>">
  
  <!-- Configure Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#1e40af',
            success: '#10b981',
            danger: '#ef4444',
            warning: '#f59e0b',
            info: '#3b82f6'
          },
          animation: {
            'spin-slow': 'spin 3s linear infinite',
          }
        },
      },
    }
  </script>
  
  <style>
    /* Additional custom styles */
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    /* Accessibility improvements */
    .focus-visible:focus-visible {
      outline: 2px solid #3b82f6;
      outline-offset: 2px;
    }
    
    /* Loading animation */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div id="root"></div>
  
  <script type="text/babel">
    // Custom hook for API calls
    function usePlaywrightTest() {
      const [state, setState] = React.useState({
        status: 'idle', // idle, loading, success, error
        data: null,
        error: null
      });
      
      const runTest = React.useCallback(async () => {
        setState({ status: 'loading', data: null, error: null });
        
        try {
          // Add a timestamp to prevent caching
          const url = `http://localhost:3001/run-test?t=${Date.now()}`;
          
          const response = await fetch(url, {
            method: 'GET',
            headers: {
              'Accept': 'application/json',
              'Cache-Control': 'no-cache'
            }
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          
          const data = await response.json();
          setState({ status: 'success', data, error: null });
          return data;
        } catch (error) {
          console.error('Error running test:', error);
          setState({ 
            status: 'error', 
            data: null, 
            error: error.message || 'Unknown error occurred' 
          });
          throw error;
        }
      }, []);
      
      return { state, runTest };
    }
    
    // Toast notification component
    function Toast({ message, type, onClose }) {
      React.useEffect(() => {
        const timer = setTimeout(() => {
          onClose();
        }, 5000);
        
        return () => clearTimeout(timer);
      }, [onClose]);
      
      return (
        <div className={`fixed bottom-4 right-4 px-6 py-3 rounded-md shadow-lg
          ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white`}>
          <div className="flex items-center">
            <span className="mr-2">
              {type === 'success' ? '‚úÖ' : '‚ùå'}
            </span>
            <span>{message}</span>
            <button 
              onClick={onClose}
              className="ml-4 text-white hover:text-gray-200 focus:outline-none"
              aria-label="Close notification"
            >
              &times;
            </button>
          </div>
        </div>
      );
    }
    
    // Main App component
    function App() {
      const { state, runTest } = usePlaywrightTest();
      const [toast, setToast] = React.useState(null);
      
      // Track component mount status for async operations
      const isMounted = React.useRef(true);
      
      // Handle test execution
      const handleRunTest = async () => {
        try {
          await runTest();
          if (isMounted.current) {
            setToast({ message: 'Test completed successfully!', type: 'success' });
          }
        } catch (error) {
          if (isMounted.current) {
            setToast({ message: `Error: ${error.message}`, type: 'error' });
          }
        }
      };
      
      // Clean up on unmount
      React.useEffect(() => {
        return () => {
          isMounted.current = false;
        };
      }, []);
      
      // Determine result message and status
      const getResultContent = () => {
        switch (state.status) {
          case 'loading':
            return (
              <div className="flex items-center justify-center space-x-2">
                <svg className="animate-spin h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Loading... Running test on the server.</span>
              </div>
            );
          case 'success':
            return state.data?.message || 'Test completed successfully';
          case 'error':
            return `Error: ${state.error}. Make sure the server is running at http://localhost:3001`;
          default:
            return 'No tests run yet. Click the button above to start a test.';
        }
      };
      
      // Determine result container class based on status
      const getResultContainerClass = () => {
        switch (state.status) {
          case 'loading':
            return 'bg-blue-50 border-blue-200 text-blue-700';
          case 'success':
            return state.data?.success 
              ? 'bg-green-50 border-green-200 text-green-700'
              : 'bg-red-50 border-red-200 text-red-700';
          case 'error':
            return 'bg-red-50 border-red-200 text-red-700';
          default:
            return 'bg-gray-50 border-gray-200 text-gray-500';
        }
      };
      
      return (
        <div className="container mx-auto px-4 py-8 max-w-md">
          <div className="bg-white rounded-lg shadow-lg p-6">
            {/* Header with logo */}
            <div className="flex items-center justify-center mb-6">
              <span className="text-4xl mr-2" role="img" aria-label="Playwright logo">üé≠</span>
              <h1 className="text-2xl font-bold text-center text-gray-800">
                Playwright Test Runner
              </h1>
            </div>
            
            {/* Test button */}
            <div className="flex justify-center mb-6">
              <button 
                onClick={handleRunTest}
                disabled={state.status === 'loading'}
                className={`
                  px-6 py-3 rounded-md font-medium text-white
                  ${state.status === 'loading' 
                    ? 'bg-gray-400 cursor-not-allowed' 
                    : 'bg-blue-600 hover:bg-blue-700 active:bg-blue-800'}
                  transition-colors duration-200 ease-in-out
                  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50
                  shadow-md hover:shadow-lg
                `}
                aria-live="polite"
              >
                <span className="flex items-center justify-center">
                  {state.status === 'loading' ? (
                    <>
                      <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                      Running Test...
                    </>
                  ) : 'Run E2E Test'}
                </span>
              </button>
            </div>
            
            {/* Result display area */}
            <div className="mt-6">
              <h2 className="text-lg font-semibold text-gray-700 mb-2">Test Results:</h2>
              <div 
                className={`p-4 rounded-md border ${getResultContainerClass()} transition-colors duration-300`}
                role="status"
                aria-live="polite"
              >
                {getResultContent()}
              </div>
              
              {/* Show timestamp if test has been run */}
              {state.data?.timestamp && (
                <div className="mt-2 text-xs text-gray-500 text-right">
                  Last run: {new Date(state.data.timestamp).toLocaleString()}
                </div>
              )}
            </div>
            
            {/* Instructions */}
            <div className="mt-6 text-sm text-gray-600 border-t pt-4">
              <p className="mb-2">
                <strong>How it works:</strong> This app connects to a Playwright test server running on port 3001.
              </p>
              <p className="flex items-center">
                <svg className="h-4 w-4 mr-1 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Make sure the server is running with <code className="bg-gray-100 px-1 py-0.5 rounded">node server.js</code> before running tests.
              </p>
            </div>
          </div>
          
          {/* Footer */}
          <footer className="mt-8 text-center text-xs text-gray-500">
            <p>Built with React, Tailwind CSS, and Playwright</p>
          </footer>
          
          {/* Toast notification */}
          {toast && (
            <Toast 
              message={toast.message} 
              type={toast.type} 
              onClose={() => setToast(null)} 
            />
          )}
        </div>
      );
    }
    
    // Render the App component to the DOM
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
